# vAlt Program ve Paketler 

Kod tekrarını önlemek, yönetimi kolaylaştırmak ve performansı artırmak amacıyla kullanılan **Alt Programlar** (Prosedür ve Fonksiyonlar) ile bunları gruplayan **Paket** yapılarını ele almaktadır.

### 1. Alt Programlar (Subprograms)

Sürekli tekrar eden kod bloklarının isimlendirilerek saklanmasıdır. Derlenmiş halde sunucuda tutuldukları için her çağrıldıklarında tekrar derlenmezler, bu da performans artışı sağlar.

- **Alt Program Türleri:**
    
    1. **Bağımsız (Standalone):** `CREATE` komutuyla doğrudan şema altında oluşturulan ve veritabanında saklanan türdür.
        
    2. **Paket Alt Programları:** Bir paket yapısı içinde tanımlananlardır.
        
    3. **İç İçe (Nested):** Bir PL/SQL bloğu içinde tanımlanan ve sadece o blokta geçerli olan türdür.
        
- **Prosedür (Procedure) ve Fonksiyon (Function) Ayrımı:**
    
    - **Prosedür:** Belirli bir işi (eylemi) yerine getirmek için kullanılır. Geriye bir değer döndürme zorunluluğu yoktur (ancak parametreler ile değer taşıyabilir). SQL sorguları (SELECT) içinde doğrudan kullanılamazlar.
        
    - **Fonksiyon:** Muhakkak geriye bir değer döndürmelidir (`RETURN` kullanımı zorunludur). Bir atama işleminde veya SQL sorgusu içinde kullanılabilirler.
        
- **Parametre Modları:**
    
    - **IN:** Varsayılan moddur. Parametre dışarıdan değer alır, alt program içinde kullanılır ancak değiştirilemez.
        
    - **OUT:** Parametre dışarıdan değer almaz, alt program içinde değer atanarak dışarıya sonuç gönderir.
        
    - **IN OUT:** Parametre hem dışarıdan başlangıç değeri alır hem de alt program içinde değiştirilerek güncel değeri dışarıya gönderir.
        

### 2. Paketler (Packages)

Birbiriyle ilişkili prosedür, fonksiyon, değişken, imleç (cursor) ve tipleri mantıksal bir çatı altında toplayan nesnelerdir. İki temel bileşenden oluşur:

1. **Paket Başlığı (Specification/Header):** Paketin "vitrini" veya arayüzüdür. Dışarıdan erişilebilecek değişkenler ve alt programların prototipleri (imzaları) burada tanımlanır. Kodun gövdesi (işleyişi) burada bulunmaz.
    
2. **Paket Gövdesi (Body):** Başlıkta tanımlanan alt programların asıl kodlarının (implementation) yazıldığı yerdir. Ayrıca sadece paket içinde geçerli olan (dışarıya kapalı/private) değişken ve alt programlar da burada tanımlanabilir.
    

- **Avantajları:**
    
    - **Modülerlik:** İlişkili işlemler bir arada tutulur.
        
    - **Gizlilik:** Paket gövdesindeki özel tanımlar dışarıdan görülmez.
        
    - **Kalıcılık:** Paket değişkenleri, oturum boyunca değerlerini korurlar.
        
    - **Aşırı Yükleme (Overloading):** Aynı isimde fakat farklı parametre yapılarına (farklı veri tipi veya sayısı) sahip birden fazla alt programın tanımlanabilmesine olanak sağlar. Bu özellik sadece paketlerde kullanılabilir.
        


## Örnekler


### Örnek 1: Parametreli Prosedür (IN ve OUT Kullanımı)

Bu örnek, dışarıdan bir çalışan ID'si alır (IN) ve o çalışanın maaşını bulup dışarıya döndürür (OUT).



```plsql
-- Prosedürün Tanımlanması
CREATE OR REPLACE PROCEDURE maas_bul (
    p_calisan_id IN NUMBER,      -- Dışarıdan veri alır
    p_maas OUT NUMBER            -- Dışarıya veri gönderir
) IS
BEGIN
    SELECT salary INTO p_maas
    FROM employees
    WHERE employee_id = p_calisan_id;
EXCEPTION
    WHEN NO_DATA_FOUND THEN
        p_maas := 0; -- Çalışan bulunamazsa 0 döndür
        DBMS_OUTPUT.PUT_LINE('Çalışan bulunamadı.');
END;
/

-- Prosedürün Çağrılması (Anonim Blok)
DECLARE
    v_gelen_maas NUMBER;
BEGIN
    -- 100 numaralı çalışanın maaşını bulup v_gelen_maas değişkenine atar
    maas_bul(100, v_gelen_maas);
    DBMS_OUTPUT.PUT_LINE('Çalışanın Maaşı: ' || v_gelen_maas);
END;
/
```

### Örnek 2: Değer Döndüren Fonksiyon (Function)

Bu örnek, verilen bir yarıçap değerine göre dairenin alanını hesaplar ve sonucu `RETURN` ile döndürür.


```plsql
-- Fonksiyonun Tanımlanması
CREATE OR REPLACE FUNCTION daire_alani_hesapla (
    p_yaricap NUMBER
) RETURN NUMBER IS
    v_pi CONSTANT NUMBER := 3.14159;
    v_alan NUMBER;
BEGIN
    v_alan := v_pi * POWER(p_yaricap, 2);
    RETURN v_alan; -- Hesaplanan değeri döndürür
END;
/

-- Fonksiyonun Kullanımı (SELECT içinde)
SELECT daire_alani_hesapla(5) AS Alan FROM DUAL;

-- Veya Anonim Blok İçinde
BEGIN
    DBMS_OUTPUT.PUT_LINE('Alan: ' || daire_alani_hesapla(10));
END;
/
```

### Örnek 3: Paket (Package) ve Aşırı Yükleme (Overloading)

Bu örnek, ders notlarında vurgulanan "Paketlerde aynı isimde metod tanımlama" (Method Overloading) konusunu gösterir. `yazdir` isminde iki prosedür tanımlanır; biri sayıları, diğeri metinleri ekrana basar.

**Adım 1: Paket Başlığı (Specification)**


```plsql
CREATE OR REPLACE PACKAGE yazdirma_araclari IS
    -- Aynı isimde iki farklı prosedür bildirimi
    PROCEDURE yazdir(p_veri NUMBER);
    PROCEDURE yazdir(p_veri VARCHAR2);
END yazdirma_araclari;
/
```

**Adım 2: Paket Gövdesi (Body)**


```plsql
CREATE OR REPLACE PACKAGE BODY yazdirma_araclari IS
    
    -- Sayı alan versiyonun kodlanması
    PROCEDURE yazdir(p_veri NUMBER) IS
    BEGIN
        DBMS_OUTPUT.PUT_LINE('Sayısal Değer: ' || p_veri);
    END yazdir;

    -- Metin alan versiyonun kodlanması
    PROCEDURE yazdir(p_veri VARCHAR2) IS
    BEGIN
        DBMS_OUTPUT.PUT_LINE('Metinsel Değer: ' || p_veri);
    END yazdir;

END yazdirma_araclari;
/
```

**Adım 3: Paketin Kullanımı**


```plsql
BEGIN
    -- PL/SQL hangi prosedürü çağıracağını veri tipinden anlar
    yazdirma_araclari.yazdir(1923);       -- Sayısal versiyon çalışır
    yazdirma_araclari.yazdir('Merhaba');  -- Metinsel versiyon çalışır
END;
/
```
