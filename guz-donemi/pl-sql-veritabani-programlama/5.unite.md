
# Kursörler 

Veritabanı sorgularından dönen sonuçların satır satır işlenmesini sağlayan kursör (imleç) yapısını ve detaylarını ele almaktadır.

### 1. Kursör (İmleç) Temel Kavramları

- **Tanım:** Sorgu sonuçlarını bir döngü aracılığıyla tek tek işlemeye yarayan PL/SQL bileşenidir.
    
- **Aktif Set (Active Set):** Oracle, sorgu sonuçlarını tutmak için özel bir bellek alanı ayırır; bu alana "aktif set" denir. Kursör bu setin en başına konumlanır ve satır satır ilerler.
    
- **Avantajları:**
    
    - Çok satırlı sorgu sonuçlarının yönetilmesini sağlar.
        
    - Veri istemciye çekilmeden sunucu belleğinde işlendiği için performans sağlar.
        
    - Veri bütünlüğünü korumak için satır kilitleme (locking) yapılabilir.
        

### 2. Kursör Türleri

PL/SQL'de iki ana kursör türü bulunur:

#### A. Örtük (Implicit) Kursörler

- **Otomatik Oluşum:** `INSERT`, `UPDATE`, `DELETE` gibi DML komutları veya tek satır döndüren `SELECT` sorguları çalıştığında sunucu tarafından otomatik oluşturulur ve kapatılır.
    
- **Yönetim:** Programcı müdahale edemez, sadece niteliklerini okuyabilir.
    
- **Nitelikler:**
    
    - `SQL%ISOPEN`: Örtük kursörlerde her zaman `FALSE` döner çünkü işlem bitince hemen kapanır.
        
    - `SQL%FOUND` / `SQL%NOTFOUND`: İşlem sonucunda satır dönüp dönmediğini belirtir.
        
    - `SQL%ROWCOUNT`: İşlemden etkilenen satır sayısını verir.
        

#### B. Aşikâr (Explicit) Kursörler

- **Manuel Kontrol:** Birden fazla satır döndüren sorgular için programcı tarafından `DECLARE` bloğunda tanımlanır.
    
- **Yaşam Döngüsü:** 4 aşamadan oluşur:
    
    1. **Tanımlama (Declare):** `CURSOR kursör_adı IS SELECT...` şeklinde yapılır.
        
    2. **Açma (Open):** `OPEN kursör_adı;` komutuyla aktif set oluşturulur.
        
    3. **Veri Çekme (Fetch):** `FETCH kursör_adı INTO değişkenler;` ile veriler satır satır alınır.
        
    4. **Kapatma (Close):** `CLOSE kursör_adı;` ile bellek serbest bırakılır.
        
- **Performans:** Sorgu sadece ilk açılışta çözümlenir (parse edilir), kapatılıp tekrar açıldığında tekrar çözümleme yapılmaz.
    
- **Parametre Kullanımı:** Kursörler parametre alarak daha esnek hale getirilebilir.
    

### 3. Kullanım Yöntemleri ve İpuçları

- **FOR Döngüsü:** Aşikâr kursörler `FOR` döngüsü ile kullanıldığında; açma, veri çekme ve kapatma işlemleri otomatik yapılır, kod kısalır.
    
- **SELECT FOR UPDATE:** Veriler işlenirken başka oturumların bu verileri değiştirmesini engellemek (kilitlemek) için kullanılır.
    
    - `NOWAIT`: Kilitli satır varsa beklemeden hata fırlatır.
        
    - `WAIT n`: Kilidin kalkması için n saniye bekler.
        
    - `SKIP LOCKED`: Kilitli satırları atlar.
        

### 4. Kursör Değişkenleri (Ref Cursor)

- **Referans Mantığı:** Doğrudan sonucu değil, sonucun bulunduğu bellek adresini referans alır.
    
- **Esneklik:** Bir kez tanımlandıktan sonra farklı sorgular için tekrar tekrar kullanılabilir ve alt programlara parametre olarak gönderilebilir.
    
- **Türleri:**
    
    - **Zayıf (Weak):** Dönüş tipi belli değildir (`SYS_REFCURSOR` veya `REF CURSOR`). Her türlü sorguyla ilişkilendirilebilir.
        
    - **Kuvvetli (Strong):** `RETURN` ile dönüş tipi belirtilir, sadece uyumlu sorgularla çalışır.
        
