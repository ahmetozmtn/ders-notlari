

# 4.Ünite - Koşul ve Döngü Yapıları

---

## 1. Giriş

PL/SQL’de **koşullar ve döngüler**, program akışını yönlendiren temel yapılardır.

- **Koşul yapıları** → Programın belirli durumlara göre farklı işlemler yapmasını sağlar.
    
- **Döngüler** → Belirli işlemleri tekrar tekrar çalıştırır.
    
- **Sıralı kontrol deyimleri** (GOTO, NULL) → Akış kontrolünü özel durumlarda düzenler.
    

---

## 2. Koşul Yapıları

Koşul (kontrol) yapıları, **BOOLEAN** (TRUE / FALSE / NULL) değerine göre karar verir.  
Sadece `TRUE` dönen koşulların içindeki kodlar çalıştırılır.

PL/SQL’de iki temel koşul yapısı vardır:

1. `IF` yapısı
    
2. `CASE` yapısı
    

---

### 2.1. IF Koşul Yapısı

#### **IF-THEN**

- En basit yapı.
    
- Koşul sağlanırsa blok çalışır; aksi halde atlanır.
    

```sql
IF sayi < 0 THEN
  DBMS_OUTPUT.PUT_LINE('Negatif sayı girdiniz.');
END IF;
```

#### **IF-THEN-ELSE**

- Koşul sağlanmazsa ELSE bloğu çalışır.
    

```sql
IF sayi > 0 THEN
  DBMS_OUTPUT.PUT_LINE('Pozitif');
ELSE
  DBMS_OUTPUT.PUT_LINE('Negatif veya Sıfır');
END IF;
```

#### **IF-THEN-ELSIF**

- Birden fazla koşul kontrolü için kullanılır.
    

```sql
IF sayi > 0 THEN
  DBMS_OUTPUT.PUT_LINE('Pozitif');
ELSIF sayi < 0 THEN
  DBMS_OUTPUT.PUT_LINE('Negatif');
ELSE
  DBMS_OUTPUT.PUT_LINE('Sıfır');
END IF;
```

> **Not:** NULL değerli değişkenlerle yapılan karşılaştırmalar her zaman **NULL** döndürür.  
> Bu durumda IF bloğu çalışmaz, ELSE bloğu yürütülür.

---

### 2.2. CASE Koşul Yapısı

#### **Basit CASE**

Bir değişkenin belirli değerlerle eşleşmesini kontrol eder.

```sql
CASE sayi
  WHEN 0 THEN DBMS_OUTPUT.PUT_LINE('Sıfır');
  WHEN 1 THEN DBMS_OUTPUT.PUT_LINE('Bir');
  ELSE DBMS_OUTPUT.PUT_LINE('Bilinmiyor');
END CASE;
```

#### **Aramalı (Searched) CASE**

Koşullar açıkça belirtilir.

```sql
CASE
  WHEN sayi MOD 2 = 0 THEN DBMS_OUTPUT.PUT_LINE('Çift');
  ELSE DBMS_OUTPUT.PUT_LINE('Tek');
END CASE;
```

> CASE yapısı, çoklu IF bloklarına göre daha okunaklıdır.

---

## 3. Döngü Yapıları

Döngüler, belirli koşullar sağlandığı sürece kodun tekrar çalışmasını sağlar.  
PL/SQL’de 3 temel döngü vardır:

1. **LOOP** (temel döngü)
    
2. **FOR döngüsü**
    
3. **WHILE döngüsü**
    

Ayrıca:

- **İç içe döngüler (nested loops)**
    
- **Döngü etiketleri**
    
- **EXIT**, **EXIT WHEN**, **CONTINUE**, **CONTINUE WHEN** deyimleri  
    ile kontrol sağlanır.
    

---

### 3.1. LOOP Döngüsü

**Sınırsız döngüdür**, koşul verilmez.  
Sonlandırmak için `EXIT` veya `EXIT WHEN` kullanılır.

```sql
DECLARE
  i NUMBER := 1;
BEGIN
  LOOP
    DBMS_OUTPUT.PUT_LINE(i);
    i := i + 1;
    EXIT WHEN i > 10;
  END LOOP;
END;
```

> Eğer `EXIT` eklenmezse **sonsuz döngü** oluşur.

---

### 3.2. FOR Döngüsü

Başlangıç ve bitiş değerleri bellidir.

```sql
FOR i IN 1..5 LOOP
  DBMS_OUTPUT.PUT_LINE(i);
END LOOP;
```

**Geriye doğru sayım** için `REVERSE` kullanılır:

```sql
FOR i IN REVERSE 10..1 LOOP
  DBMS_OUTPUT.PUT_LINE(i);
END LOOP;
```

> Döngü indisi (`i`) sadece döngü bloğu içinde geçerlidir.  
> Döngü bitince erişilemez.

---

### 3.3. WHILE Döngüsü

Koşul doğru olduğu sürece döngü çalışır.

```sql
DECLARE
  i NUMBER := 1;
BEGIN
  WHILE i <= 5 LOOP
    DBMS_OUTPUT.PUT_LINE(i);
    i := i + 1;
  END LOOP;
END;
```

> Koşul başlangıçta FALSE ise döngü hiç çalışmaz.

---

## 4. İç İçe Döngüler (Nested Loops) ve Etiketler

Bir döngü içinde başka bir döngü çalıştırılabilir.  
Her döngünün sayaç değişkeni farklı olmalıdır.

```sql
FOR i IN 1..3 LOOP
  FOR j IN 1..3 LOOP
    DBMS_OUTPUT.PUT_LINE('i='||i||', j='||j);
  END LOOP;
END LOOP;
```

### **Etiket Kullanımı**

Okunabilirliği artırır, karmaşık döngülerde özellikle faydalıdır.

```sql
<<dis_dongu>>
FOR i IN 1..5 LOOP
  <<ic_dongu>>
  FOR j IN 1..5 LOOP
    EXIT dis_dongu WHEN j = 3;
  END LOOP ic_dongu;
END LOOP dis_dongu;
```

> Dış döngü, içteki döngü tarafından **etiketle sonlandırılabilir**.  
> Ancak tersi (iç döngünün dıştan kapatılması) mümkün değildir.

---

## 5. Sıralı Kontrol Deyimleri

PL/SQL, akışı özel durumlarda yönlendirmek için iki deyim sunar:

### **5.1. GOTO**

Program akışını belirtilen etikete yönlendirir.  
Ancak **tavsiye edilmez** (kodun okunurluğunu düşürür).

```sql
BEGIN
  GOTO atla;
  DBMS_OUTPUT.PUT_LINE('Bu satır çalışmaz.');
  <<atla>>
  DBMS_OUTPUT.PUT_LINE('GOTO etiketi atlandı.');
END;
```

### **5.2. NULL**

Hiçbir işlem yapmaz, genellikle **boş koşul** için kullanılır.

```sql
IF sayi = 0 THEN
  NULL; -- hiçbir şey yapılmaz
ELSE
  DBMS_OUTPUT.PUT_LINE('Sıfır değil');
END IF;
```

---

### Sonuç
- **Koşullar**: `IF`, `ELSIF`, `CASE`
    
- **Döngüler**: `LOOP`, `FOR`, `WHILE`
    
- **Kontrol deyimleri**: `EXIT`, `CONTINUE`, `GOTO`, `NULL`
    
- İç içe döngülerde **etiketler** okunabilirliği artırır.
    
- `EXIT WHEN` koşulu sağlanmazsa **sonsuz döngü** oluşur.
    